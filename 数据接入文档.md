# ![img](https://testland.orientsoft.cn/static/img/opengas.png)开燃云集平台数据接入文档

| 日期         | 版本   | 描述   | 作者    |
| ---------- | ---- | ---- | ----- |
| 2018-01-03 | V1.0 | 初版   | 王磊，张胜 |

## 概述

本文档用于说明同开燃云集燃气云平台进行对接的数据接入要求。数据接入由接入方提供开燃云集云平台所需的CSV文件。

CSV文件格式要求如下：

1. 使用英文逗号`,`作为字段分隔符
2. 使用标准换行符`\n`作为记录分隔符
3. 空值使用空字符串表示，且不需要引号
4. 可以使用`“`包裹字段
5. 如果字段内容包含`“`，双写`“`
6. 如果是NULL值，填写`N/A`
7. 所有CSV文件均需使用`ＵＴＦ-8`文件编码。

例子：将记录 [ `1`,`1`,`AA,BB`,`一,二"三 `] 导出为CSV。

```python
1,1,"AA,BB","一,二""三"
```

针对每一张表，都必须提供一个以该表名为名称的CSV文件，如提供流水表信息的CSV文件名为`流水.CSV`．每个CSV文件中的第一行应当是该表的字段名．

下节将逐一描述每张表所需字段及其详细信息．同时，对于描述中的个别列，我们有如下约定：

- 字段描述列以ID结尾：如无特殊说明，所有以（自身表名+ID）命名的均表示该表的主键，所有（其他表名+ID）均表示外键。所有的主键和外键都必须填写。所有的人员ID均表示`操作员`表的外键 ．
- NULL约束列 :  如无特殊说明，该字段未填写表示`NOT NULL`，填写`NULL`表示该字段可以设为空值，即:`N/A`
- 取值描述列
  - `(0-女性,1-男性,2-未知)`类型的描述表示该字段取值为0,1或２
  - `(A,B,C,D)`类型的描述表示取值为A,B,C或D

对于表示时间的字段，我们将在取值描述中采用下面的格式字符串描述:

| 格式   | 描述                  |
| ---- | ------------------- |
| %Y   | 四位数的年份表示（0000-9999） |
| %m   | 月份（01-12）           |
| %d   | 月内中的一天（0-31）        |
| %H   | 24小时制小时数（0-23）      |
| %M   | 分钟数（00-59）          |
| %S   | 秒（00-59）            |

最后，值类型为DECIMAL(N,M)时表示字段为小数字，其总长度为Ｎ（不包括小数点），小数部分长度为Ｍ.

## 表详情

### 基本信息表

| 字段       | 取值描述                               | 示例         | NULL约束 | 值类型          |
| -------- | ---------------------------------- | ---------- | ------ | ------------ |
| 公司名      |                                    | 天然气公司      |        | Varchar(45)  |
| 滞纳金计算类型  | (1-固定起算日期,2-发行后XX天为起算日期)           | 1          |        | Varchar(2)   |
| Delta    | 如果计算类型为1,表示下月的的日期如果计算类型为2,表示多少天后起算 | 20:下月20号起算 |        | Int          |
| 滞纳金利率    |                                    | 0.0030     |        | Decimal(5,4) |
| 表端计费方式   | 按气量,按金额:可全选或者单选,全选需要逗号隔开           | 按气量,按金额    |        | Varchar(100) |
| 抄表周期     | 单位为月，值必须为整数                        | 2          |        | Tinyint      |
| 抄表周期开始月份 | 任意一个抄表周期的开始月份，其值的格式为：＇%Y-%m-%d＇    | 2017-12-01 |        | Date         |

### 营业厅表

| 字段    | 取值描述 | 示例         | NULL约束 | 值类型         |
| ----- | ---- | ---------- | ------ | ----------- |
| 营业厅ID |      | 1          |        | Varchar(10) |
| 营业厅名称 |      | XX营业厅      |        | Varchar(45) |
| 营业厅地址 |      | XX镇XX街XX号  |        | Varchar(45) |
| 营业厅电话 |      | 4008888888 | NULL   | Varchar(20) |

### 操作员表

| 字段      | 取值描述        | 示例                 | NULL约束            | 值类型         |
| ------- | ----------- | ------------------ | ----------------- | ----------- |
| 操作员ID   |             | 1                  |                   | Int         |
| 操作员姓名   |             | 张三                 |                   | Varchar(45) |
| 营业厅ID   |             | 1                  | 如果是系统管理员，可以不填写该字段 | Varchar(20) |
| 身份证号码   |             | 548869547856985245 | NULL              | Int         |
| 状态      | (活动,注销)     | 活动                 |                   | Enum        |
| 电话号码    |             | 15958658694        | NULL              | Varchar(20) |
| 系统登陆帐号名 |             |                    |                   | Varchar(20) |
| 登陆密码    | 加密前的密码，可以不填 |                    | NULL              | Varchar(32) |

### 区域表

| 字段   | 取值描述 | 示例   | NULL约束 | 值类型         |
| ---- | ---- | ---- | ------ | ----------- |
| 区域ID |      | 1    |        | Varchar(32) |
| 区域名  |      | 一二三  |        | Varchar(45) |

### 价格表

| 字段   | 取值描述                                     | 示例                                       | NULL约束 | 值类型          |
| ---- | ---------------------------------------- | ---------------------------------------- | ------ | ------------ |
| 价格ID |                                          | 1                                        |        | Int          |
| 单价   | 如果需要表示阶梯气价，需要使用的格式为：阶梯1价格\| 阶梯1气量\|阶梯2价格... | 非阶梯气价:2.3阶梯气价: 1\|50\|2\|80\|3 表示`方量<=50`时，单价为1;`50<方量<=80`时，单价为2;`80<方量`时，单价为3 |        | Varchar(512) |
| 价格类型 | (居民,商业,工业,公福,CNG,管网租赁,不适用)               | 居民                                       |        | Enum         |
| 设备类型 | 该价格所属设备类型：（GAS-燃气表, WATER-水表,EM-电表,OTH-其他） | GAS                                      |        | Varchar(30)  |

### 用户表

| 字段     | 取值描述                    | 示例                  | NULL约束 | 值类型          |
| ------ | ----------------------- | ------------------- | ------ | ------------ |
| 用户ID   |                         | 1                   |        | Varchar(20)  |
| 证件类型   | (身份证，户口簿，军官证，护照，社会信用代码) | 身份证                 |        | enum         |
| 证件号码   |                         | 511358459685258745  |        | Varchar(20)  |
| 用户姓名   |                         | 张三                  |        | Varchar(50)  |
| 用户电话   |                         | 15358248569         |        | Varchar(20)  |
| 用户备用电话 |                         | 12312323            | NULL   | Varchar(20)  |
| 性别     | 0:女性1:男性2:未知            | 1                   |        | Varchar(10)  |
| 开户日期   | 格式为：＇%Y-%m-%d　%H:%M:%S＇ | 2014-11-27 09:30:02 |        | datetime     |
| 开户人员ID | 操作员ID                   | 1                   |        | Varchar(45)  |
| 修改日期   | 格式为：＇%Y-%m-%d　%H:%M:%S＇ | 2014-11-27 09:30:02 | NULL   | Varchar(45)  |
| 修改人员ID | 操作员ID                   | 1                   | NULL   | datetime     |
| 备注     |                         | 合同单遗失已领卡            | NULL   | Varchar(100) |

### 地址表

| 字段     | 取值描述                                     | 示例                  | NULL约束 | 值类型          |
| ------ | ---------------------------------------- | ------------------- | ------ | ------------ |
| 地址ID   |                                          | 1                   |        | Varchar(32)  |
| 地址描述   |                                          | XX村XX组XX号           |        | Varchar(100) |
| 用户ID   |                                          | 1                   |        | Varchar(20)  |
| 房屋结构   | (1-楼房,2-平房,3-小二楼,4-高层,5-公寓,6-别墅,7-厂房,8-野外,9-其他) |                     |        | Varchar(10)  |
| 合同编号   |                                          | 11111               |        | Varchar(20)  |
| 用气类型   | (个人，工商)                                  | 居民用气                |        | Enum         |
| 地址状态   | (正常,冻结,注销)                               | 正常                  |        | enum         |
| 用户状态   | (已入户,未入户,已销户)                            | 未入户                 |        | enum         |
| 创建日期   | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  | 2014-11-26 10:20:30 |        | datetime     |
| 创建人员ID | 操作员ID                                    | 1                   |        | Varchar(10)  |
| 更新日期   | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  | 2014-11-26 10:20:30 | NULL   | datetime     |
| 更新人员ID | 操作员ID                                    | 1                   | NULL   | Varchar(10)  |
| 区域ID   |                                          | 1                   |        | Varchar(32)  |
| 备注     |                                          |                     | NULL   | Varchar(100) |
| 用户卡号   |                                          | 12345               | NULL   | Varchar(45)  |
| 抄表册ID  | 当前所属抄表册ID                                |                     | NULL   | int          |

### 账户表

| 字段     | 取值描述                    | 示例   | NULL约束 | 值类型           |
| ------ | ----------------------- | ---- | ------ | ------------- |
| 地址ID   |                         | 1    |        | Varchar(32)   |
| 剩余金额   |                         | 25.5 |        | Decimal(11,3) |
| 剩余气量   |                         | 0.6  | NULL   | Decimal(11,3) |
| 支付方式   | (现金缴费,预存款扣款,银行代扣,其他)    | 现金缴费 |        | enum          |
| 托收银行   |                         |      | NULL   | Varchar(20)   |
| 托收卡号   |                         |      | NULL   | Varchar(20)   |
| 创建时间   | 格式为：＇%Y-%m-%d　%H:%M:%S＇ |      |        | datetime      |
| 创建人员ID |                         |      |        | Varchar(45)   |

### 燃气表类型表

| 字段      | 取值描述                                     | 示例    | NULL约束 | 值类型         |
| ------- | ---------------------------------------- | ----- | ------ | ----------- |
| 燃气表类型ID |                                          |       |        | Int         |
| 燃气表品牌   |                                          | 海力    |        | Varchar(25) |
| 燃气表类型   | (普通燃气表,远传燃气表,涡轮流量计,罗茨流量计,超声波燃气表,IC卡表,普通水表) |       |        | enum        |
| 燃气表容积   |                                          | J10.0 |        | Varchar(45) |
| 燃气表量程   |                                          | 99999 |        | int         |
| 表存上限    |                                          |       | NULL   | float       |
| 透支额     |                                          |       | NULL   | float       |
| 报警量     |                                          |       | NULL   | float       |
| 设备类型    | （GAS-燃气表, WATER-水表,EM-电表,OTH-其他）         | GAS   |        | Varchar(45) |

### 表具表

| 字段             | 取值描述                    | 示例                  | NULL约束 | 值类型           |
| -------------- | ----------------------- | ------------------- | ------ | ------------- |
| 表具ID           |                         |                     |        | Varchar(32)   |
| 地址ID           |                         |                     |        | Varchar(32)   |
| 安装时间           | 格式为：＇%Y-%m-%d　%H:%M:%S＇ |                     |        | datetime      |
| 安装人员ID         | 操作员ID                   |                     |        | Varchar(45)   |
| 启封时间           | 格式为：＇%Y-%m-%d　%H:%M:%S＇ |                     | NULL   | datetime      |
| 启封人员ID         | 操作员ID                   |                     | NULL   | Varchar(45)   |
| 拆除时间           | 格式为：＇%Y-%m-%d　%H:%M:%S＇ |                     | NULL   | datetime      |
| 拆除人员ID         | 操作员ID                   |                     | NULL   | Varchar(45)   |
| 更新时间           | 格式为：＇%Y-%m-%d　%H:%M:%S＇ |                     | NULL   | datetime      |
| 更新人员ID         | 操作员ID                   |                     | NULL   | Varchar(45)   |
| 设备状态           | (待用,使用,停用,拆除)           |                     |        | enum          |
| 退役期限           | 格式为：＇%Y-%m-%d　%H:%M:%S＇ | 2028-01-01 00:00:00 |        | datetime      |
| 调节因子/温压补偿系数    |                         | 1                   |        | Decimal(6,3)  |
| 自编号            |                         | 12345               | NULL   | Varchar(45)   |
| 表钢号            |                         | 23344212            |        | Varchar(30)   |
| 收费类型           | (按金额,按气量)               |                     |        | enum          |
| 结算方式           | (充值结算,抄表结算)             |                     |        | enum          |
| 初始表底读数         |                         |                     |        | int           |
| 年总用气量          | 本年总用气量                  |                     |        | int           |
| 上次表底           |                         |                     |        | int           |
| 价格ID           |                         |                     |        | int           |
| 燃气表类型ID        |                         |                     |        | int           |
| 备注             |                         |                     | NULL   | Varchar(100)  |
| 通气编号           |                         |                     | NULL   | Varchar(45)   |
| 上次抄表日期         | 格式为：＇%Y-%m-%d　%H:%M:%S＇ |                     | NULL   | datetime      |
| IC卡号           | IC卡表必填，如果还没有发卡可以不填      |                     | NULL   | Varchar(45)   |
| 读卡得到的IC卡累计购气量  | IC卡表填写，未读到则不填写          |                     | NULL   | Decimal(11,3) |
| 读卡得到的IC卡累计购气次数 | IC卡表填写，未读到则不填写          |                     | NULL   | int           |
| IC卡上次购气时间      | IC卡表填写，如果未发生购气则不填写      |                     | NULL   | datetime      |
| IC卡上次购气量       | IC卡表填写，如果未发生购气则不填写      |                     | NULL   | Decimal(11,3) |
| 读卡得到的IC卡累计用气量  | IC卡表填写，未读到则不填写          |                     | NULL   | Decimal(11,3) |
| IC卡上次购气时的价格ID  | IC卡表填写，如果未发生购气则不填写      |                     | NULL   | Varchar(100)  |
| 读卡得到的IC卡补卡次数   | IC卡表填写，未读到则不填写          |                     | NULL   | int           |
| 固定调节用气量        | 每个抄表周期优惠的气量             |                     | NULL   | Decimal(5,2)  |

### 抄表册表

| 字段      | 取值描述                                     | 示例   | NULL约束 | 值类型          |
| ------- | ---------------------------------------- | ---- | ------ | ------------ |
| 抄表册ID   |                                          |      |        | int          |
| 抄表册描述   |                                          |      |        | Varchar(100) |
| 抄表员ID   |                                          |      |        | Varchar(45)  |
| 抄表周期    | 单位为月                                     |      |        | int          |
| 抄表册状态   | (0-初始状态，可编册.1-已生成抄表册，不能再编册)              |      |        | Varchar(2)   |
| 抄表区域ID  |                                          |      |        | Varchar(32)  |
| 自动生成标志  | (1-不自动生成下个抄表周期的抄表册，２-该抄表册完成后自动转变为下个周期的抄表册) |      |        | Varchar(2)   |
| 抄表册开始日期 | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  |      |        | datetime     |

### 抄表记录表

| 字段         | 取值描述                                     | 示例   | NULL约束 | 值类型           |
| ---------- | ---------------------------------------- | ---- | ------ | ------------- |
| 抄表记录ID     |                                          |      |        | Varchar(32)   |
| 地址ID       |                                          |      |        | Varchar(32)   |
| 用户ID       |                                          |      |        | Varchar(20)   |
| 区域ID       |                                          |      |        | Varchar(32)   |
| 表具ID       |                                          |      |        | Varchar(32)   |
| 抄表员ID      | 操作员ID                                    |      |        | Varchar(45)   |
| 抄表区间       | 生成该抄表记录的区间（周期）                           |      |        | Varchar(8)    |
| 抄表日期       | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  |      |        | datetime      |
| 上次表底读数     |                                          |      |        | int           |
| 本次表底读数     |                                          |      |        | int           |
| 本次用气量      |                                          |      |        | int           |
| 超量程标志      | (1- 超出量程,0-未过量程)：记录的是本次抄表的时候，该表是否超量程。    |      |        | int           |
| 抄表记录修改标志   | (1-第一次提交,2-修改')                          |      | NULL   | Varchar(10)   |
| 抄表记录修改备注   |                                          |      | NULL   | Varchar(45)   |
| 抄表记录修改人员ID | 操作员ID                                    |      | NULL   | Varchar(45)   |
| 抄表记录修改时间   | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  |      | NULL   | datetime      |
| 价格ID       |                                          |      |        | int           |
| 调节用气量      | 调节应收的气量，可正可负，不影响表底。收费时的气量计算公式：本次用气量=((本次表底-上次表底)+过量程标志*(量程+1))+调节用气量 |      |        | int           |
| 抄表状态       | (1-待抄表,2-已抄表,3-已审核,4-已关闭)                |      |        | Varchar(20)   |
| 抄表描述       | (1-正常抄表,2-用户不在家,3-表故障,4-零散抄表（抽查抄表，换表抄表，停用抄表）) |      | NULL   | Varchar(20)   |
| 备注         |                                          |      | NULL   | Varchar(45)   |
| 量程         |                                          |      |        | int           |
| 调节因子       | 用于计算本次应收的费用，用法为：本次气费=气量*单价*调节因子          |      | NULL   | Decimal(6,3)  |
| 预算金额       | 本次的燃气费                                   |      |        | Decimal(12,2) |
| 表钢号        | 所抄表的表钢号                                  |      |        | Varchar(30)   |
| 抄表册ID      |                                          |      | NULL   | int           |

### 应收表

| 字段描述     | 取值描述                                     | 示例   | NULL约束 | 值类型           |
| -------- | ---------------------------------------- | ---- | ------ | ------------- |
| 应收ID     |                                          |      |        | int           |
| 抄表记录ID   |                                          |      | NULL   | Varchar(32)   |
| 用户ID     |                                          |      |        | Varchar(20)   |
| 费用生成日期   | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  |      |        | datetime      |
| 费用截止日期   | 过了截止日期开始计算滞纳金,格式为：＇%Y-%m-%d　%H:%M:%S＇    |      |        | datetime      |
| 应收账期     | 格式：’％Ｙ%m’如 201609 代表 2016年9月             |      |        | Varchar(10)   |
| 地址ID     |                                          |      |        | Varchar(32)   |
| 费用类型     | (燃气使用费,开户费,售后维修费,欠费补交,换表收费,开通检查费,第三方代收费) |      |        | enum          |
| 本次应收     |                                          |      |        | Decimal(10,2) |
| 滞纳金      |                                          |      | NULL   | Decimal(10,2) |
| 减免后滞纳金   |                                          |      | NULL   | Decimal(10,2) |
| 应收状态     | (1-未收,2-已收,3-冲正,4-取消)                    |      |        | Varchar(2)    |
| 应收生成人员ID | 操作员ID                                    |      |        | Varchar(45)   |
| 流水ID     | 如果这笔应收产生过流水，需要填写该字段                      |      | NULL   | int           |
| 燃气表ID    |                                          |      | NULL   | Varchar(32)   |
| 取消人员ID   | 取消了该应收的操作员的ID                            |      | NULL   | Varchar(45)   |

### 流水表

| 字段        | 取值描述                                     | 示例                               | NULL约束 | 值类型           |
| --------- | ---------------------------------------- | -------------------------------- | ------ | ------------- |
| 主流水ID     |                                          |                                  |        | int           |
| 次流水号      | 为该流水在主流水中的次序，从１开始                        |                                  |        | Varchar(2)    |
| 用户ID      |                                          |                                  |        | Varchar(20)   |
| 地址ID      |                                          |                                  |        | Varchar(32)   |
| 交款时间      | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  |                                  |        | datetime      |
| 本次应交款     | 表示用户应该缴纳的金额，如果不是缴费的流水可以不填。               | 如果是一笔退了100元的流水，那么该字段值为100,不用负数表示 | NULL   | Decimal(10,2) |
| 缴费渠道      | (001-现金,002-银行代扣,003-POS刷卡,004-自助缴费,005-充值卡,006-微信支付,007-支付宝支付,008-其他第三方支付),如果不是缴费的流水可以不填 |                                  | NULL   | Varchar(10)   |
| 支付帐号      |                                          |                                  | NULL   | Varchar(45)   |
| 发票号       | 如果有多个，以英文逗号隔开                            |                                  |        | Varchar(100)  |
| 开票时间      | 格式为：＇%Y-%m-%d　%H:%M:%S＇                  |                                  |        | datetime      |
| 主流水类型     | (8-预存（子流水类型必须为８），6-抵扣应收（此类流水必须有相应的应收，且子流水类型必须为６），86-存钱和抵扣应收同时发生（此类流水必须有相应的应收，且子流水至少两条，第一条类型为８，之后的类型为６），867-(IC卡写卡，分为预存子流水８，购气子流水６，写卡子流水７)) |                                  |        | Varchar(10)   |
| 子流水类型     | (1-收开发商工程款,2-退款,3-冲正,6-抵扣应收,7-写卡,8-预存,9-缴燃气费,10-个人其他费,11-发卡,12-补卡,13-制开户卡,14-清卡,15-清表卡)，　如果是冲正，那么主流水ID应该和被冲正流水ID一致，且此流水号＝该主流水组中最大子流水号+1 |                                  |        | Varchar(10)   |
| 操作员ID     |                                          |                                  |        | Varchar(10)   |
| 交易前账户剩余金额 |                                          |                                  |        | Decimal(10,2) |
| 交易后账户剩余金额 |                                          |                                  |        | Decimal(10,2) |
| 本次交易金额    | 这三个交易金额，均表示用户账户上的余额变动情况，不要使用负数           |                                  |        | Decimal(10,2) |
| 交易前账户剩余气量 | 用于IC卡，IC卡流水必填                            |                                  | NULL   | Decimal(11,3) |
| 交易后账户剩余气量 | 用于IC卡，IC卡流水必填                            |                                  | NULL   | Decimal(11,3) |
| 本次交易气量    | 用于IC卡，IC卡流水必填。均表示用户账户上的气量余额变动情况，不要使用负数   |                                  | NULL   | Decimal(11,3) |
